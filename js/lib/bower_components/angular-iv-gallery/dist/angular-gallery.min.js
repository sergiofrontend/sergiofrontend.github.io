!function(){"use strict";function e(){return{restrict:"E",templateUrl:"gallery.directive.html",scope:{galleryDataUrl:"@",pusherKey:"@",pusherChannel:"@",pusherEvent:"@",pushedDataName:"@"},link:n,controller:"GalleryController",controllerAs:"vm"}}function t(e,t,n,a){function l(e){function t(e){y.galleryData=e,y.items=y.galleryData.data,o(w),g(),s(".modal"),x&&(r(),x=!1)}function n(e){y.errors=e}a.query(e).then(t,n)}function r(){var t=e.pusherKey,a=e.pusherChannel,l=e.pusherEvent;if(t&&a){var r=new Pusher(t),s=n(r),o=s.subscribe(a);o.bind(l,i)}}function i(t){if(p(y.pages.length)){var n=y.chunk,a=e.pushedDataName,l=t[a];if(0===n.length||n[n.length-1].length===w&&y.galleryData.data.length<y.galleryData.per_page){var r=[];r.push(l),n.push(r),y.items.push(l),s("#"+l.id)}else n[n.length-1].length<w?(n[n.length-1].push(l),y.items.push(l),s("#"+l.id)):y.galleryData.data.length===y.galleryData.per_page&&y.pages.push(y.pages.length+1)}}function s(e){t(function(){$(e).on("hidden.bs.modal",function(e){var t=$(this).find("video");t.attr("src",t.attr("src"))})})}function o(e){for(var t=[],n=y.items,a=n.length,l=0;a>l;l+=e)t.push(n.slice(l,l+e));y.chunk=t}function u(e){return e?e.indexOf("image")>-1:!1}function c(e){return e?e.indexOf("video")>-1:!1}function g(){if(jQuery.isEmptyObject(y.galleryData))return void(y.pages=[]);for(var e=y.galleryData.last_page,t=[],n=1;e>=n;n++)t.push(n);y.pages=t}function d(){return y.pages.length>1}function m(e){return b+"?"+D+"="+e}function p(e){return jQuery.isEmptyObject(y.galleryData)?!1:0===y.galleryData.last_page||y.galleryData.current_page===e}function h(e){l(m(e))}function f(){var e=y.galleryData.prev_page_url;e&&l(b+e)}function v(){var e=y.galleryData.next_page_url;e&&l(b+e)}var y=this,b=e.galleryDataUrl,D="page",w=4,x=!0;l(b),y.galleryData={},y.items=[],y.pages=[],o(w),g(),y.isImage=u,y.isVideo=c,y.multiPage=d,y.paginationUrl=m,y.isCurrent=p,y.showPage=h,y.prev=f,y.next=v}function n(e,t,n){t.on("$destroy",a)}function a(){console.debug("angular-gallery destroyed!")}angular.module("angularGallery",["gallery.service","templates","pusher-angular"]).directive("angularGallery",e).controller("GalleryController",["$scope","$timeout","$pusher","galleryService",t])}(),function(){"use strict";function e(e,t){function n(n){function a(e){return e.data}function l(t){var n=t.data;return e.reject(n)}return t.get(n).then(a,l)}return{query:n}}angular.module("gallery.service",[]).factory("galleryService",e),e.$inject=["$q","$http"]}(),angular.module("templates",[]).run(["$templateCache",function(e){e.put("gallery.directive.html",'<div ng-repeat="row in vm.chunk" class="row">\n    <div ng-repeat="item in row"\n         class="col-xs-10 col-xs-offset-1 col-sm-5 col-sm-offset-1 col-md-3 col-md-offset-0 col-lg-3 col-lg-offset-0"\n         style="margin-bottom: 5px;">\n        <a data-toggle="modal" href="#{{item.id}}">\n            <img ng-src="{{item.thumbnail}}"\n                 alt="{{item.title}}"\n                 style="width: 100%;">\n        </a>\n    </div>\n</div>\n\n<nav class="text-center" ng-if="vm.multiPage()">\n    <ul class="pagination">\n        <li><a href="" ng-click="vm.prev()">&laquo;</a></li>\n        <li ng-repeat="page in vm.pages" ng-class="{active: vm.isCurrent(page)}">\n            <a href="" ng-click="vm.showPage(page)">{{page}}</a>\n        </li>\n        <li><a href="" ng-click="vm.next()">&raquo;</a></li>\n    </ul>\n</nav>\n\n<div ng-repeat="item in vm.items" class="modal fade" id="{{item.id}}">\n    <div class="modal-dialog modal-lg">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n                <h4 class="modal-title">{{item.title}}</h4>\n            </div>\n            <div class="modal-body">\n                <img ng-if="vm.isImage(item.type)"\n                     ng-src="{{item.href}}"\n                     alt="{{item.title}}"\n                     style="width: 100%;">\n\n                <video ng-if="vm.isVideo(item.type)"\n                       src="{{item.href}}"\n                       poster="{{item.poster}}"\n                       controls\n                       style="width: 100%;"></video>\n            </div>\n            <div class="modal-footer">\n                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>\n            </div>\n        </div>\n    </div>\n</div>')}]);